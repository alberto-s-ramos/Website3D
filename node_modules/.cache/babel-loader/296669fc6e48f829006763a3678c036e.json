{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/alberto.ramos/Documents/Personal/GitHub/Website3D/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _construct from \"/Users/alberto.ramos/Documents/Personal/GitHub/Website3D/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/construct\";\nimport _defineProperty from \"/Users/alberto.ramos/Documents/Personal/GitHub/Website3D/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toArray from \"/Users/alberto.ramos/Documents/Personal/GitHub/Website3D/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toArray\";\nimport _slicedToArray from \"/Users/alberto.ramos/Documents/Personal/GitHub/Website3D/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"/Users/alberto.ramos/Documents/Personal/GitHub/Website3D/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport * as THREE from 'three';\nimport { Layers, Color, Texture, sRGBEncoding, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, Vector3, PCFSoftShadowMap, ACESFilmicToneMapping, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport React__default, { createContext, useState, useRef, useMemo, useCallback, useLayoutEffect, useEffect, createElement, useContext as useContext$1 } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport usePromise from 'react-promise-suspense';\nimport useMeasure from 'react-use-measure';\nimport { ResizeObserver } from '@juggle/resize-observer';\nimport mergeRefs from 'react-merge-refs';\nvar version = \"4.2.21\";\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nvar roots = new Map();\nvar emptyObject = {};\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a) && !is.arr(a);\n  },\n  fun: function fun(a) {\n    return typeof a === 'function';\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return Array.isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\n\nfunction createSubs(callback, subs) {\n  var index = subs.length;\n  subs.push(callback);\n  return function () {\n    return void subs.splice(index, 1);\n  };\n}\n\nvar globalEffects = [];\nvar globalAfterEffects = [];\nvar globalTailEffects = [];\n\nvar addEffect = function addEffect(callback) {\n  return createSubs(callback, globalEffects);\n};\n\nvar addAfterEffect = function addAfterEffect(callback) {\n  return createSubs(callback, globalAfterEffects);\n};\n\nvar addTail = function addTail(callback) {\n  return createSubs(callback, globalTailEffects);\n};\n\nfunction renderGl(state, timestamp) {\n  var repeat = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var runGlobalEffects = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  }); // Run local effects\n\n  var delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(function (sub) {\n    return sub.ref.current(state.current, delta);\n  }); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera); // Run global effects\n\n  if (runGlobalEffects) globalAfterEffects.forEach(function (effect) {\n    return effect(timestamp);\n  });\n  return repeat;\n}\n\nvar running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  var repeat = 0; // Run global effects\n\n  globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  });\n  roots.forEach(function (root) {\n    var state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  }); // Run global after-effects\n\n  globalAfterEffects.forEach(function (effect) {\n    return effect(timestamp);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop);else {\n    // Tail call effects, they are called when rendering stops\n    globalTailEffects.forEach(function (effect) {\n      return effect(timestamp);\n    });\n  } // Flag end of operation\n\n  running = false;\n}\n\nfunction _invalidate() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n  var frames = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 2;\n  if (state === true) roots.forEach(function (root) {\n    return root.containerInfo.__state.current.frames = frames;\n  });else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\n\nvar catalogue = {};\n\nvar extend = function extend(objects) {\n  return void (catalogue = _extends({}, catalogue, objects));\n};\n\nfunction applyProps(instance, newProps) {\n  var oldProps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var accumulative = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  // Filter equals, events and reserved props\n  var container = instance.__container;\n  var sameProps = Object.keys(newProps).filter(function (key) {\n    return is.equ(newProps[key], oldProps[key]);\n  });\n  var handlers = Object.keys(newProps).filter(function (key) {\n    // Event-handlers ...\n    //   are functions, that\n    //   start with \"on\", and\n    //   contain the name \"Pointer\", \"Click\", \"ContextMenu\", or \"Wheel\"\n    if (is.fun(newProps[key]) && key.startsWith('on')) {\n      return key.includes('Pointer') || key.includes('Click') || key.includes('ContextMenu') || key.includes('Wheel');\n    }\n  });\n  var leftOvers = accumulative ? Object.keys(oldProps).filter(function (key) {\n    return newProps[key] === void 0;\n  }) : [];\n  var toFilter = [].concat(_toConsumableArray(sameProps), ['children', 'key', 'ref']); // Instances use \"object\" as a reserved identifier\n\n  if (instance.__instance) toFilter.push('object');\n  var filteredProps = toFilter.reduce(function (acc, prop) {\n    var rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(function (key) {\n    return key !== 'children' && (filteredProps[key] = undefined);\n  });\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach(function (_ref3) {\n      var _ref4 = _slicedToArray(_ref3, 2),\n          key = _ref4[0],\n          value = _ref4[1];\n\n      if (!handlers.includes(key)) {\n        var _instance$__container;\n\n        var root = instance;\n        var target = root[key];\n\n        if (key.includes('-')) {\n          var entries = key.split('-');\n          target = entries.reduce(function (acc, key) {\n            return acc[key];\n          }, instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            var _entries$reverse = entries.reverse(),\n                _entries$reverse2 = _toArray(_entries$reverse),\n                name = _entries$reverse2[0],\n                reverseEntries = _entries$reverse2.slice(1);\n\n            root = reverseEntries.reverse().reduce(function (acc, key) {\n              return acc[key];\n            }, instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        var isColorManagement = (_instance$__container = instance.__container) == null ? void 0 : _instance$__container.__state.current.colorManagement;\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          var _target;\n\n          // If value is an array it has got to be the set function\n          if (Array.isArray(value)) (_target = target).set.apply(_target, _toConsumableArray(value)); // Test again target.copy(class) next ...\n          else if (target.copy && value && value.constructor && target.constructor.name === value.constructor.name) target.copy(value); // If nothing else fits, just set the single value, ignore undefined\n          // https://github.com/react-spring/react-three-fiber/issues/274\n          else if (value !== undefined) {\n            target.set(value); // Auto-convert sRGB colors, for now ...\n            // https://github.com/react-spring/react-three-fiber/issues/344\n\n            if (isColorManagement && target instanceof Color) {\n              target.convertSRGBToLinear();\n            }\n          } // Else, just overwrite the value\n        } else {\n          root[key] = value; // Auto-convert sRGB textures, for now ...\n          // https://github.com/react-spring/react-three-fiber/issues/344\n\n          if (isColorManagement && root[key] instanceof Texture) {\n            root[key].encoding = sRGBEncoding;\n          }\n        }\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      var index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) container.__interaction.push(instance); // Add handlers to the instances handler-map\n\n      instance.__handlers = handlers.reduce(function (acc, key) {\n        return _extends({}, acc, _defineProperty({}, key.charAt(2).toLowerCase() + key.substr(3), newProps[key]));\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) _invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.onUpdate) instance.onUpdate(instance);\n}\n\nfunction createInstance(type, _ref, container, hostContext, internalInstanceHandle) {\n  var _ref$args = _ref.args,\n      args = _ref$args === void 0 ? [] : _ref$args,\n      props = _objectWithoutPropertiesLoose(_ref, [\"args\"]);\n\n  var name = \"\" + type[0].toUpperCase() + type.slice(1);\n  var instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else if (type === 'new') {\n    instance = new props.object(args);\n  } else {\n    var target = catalogue[name] || THREE[name];\n\n    if (!target) {\n      throw \"\\\"\" + name + \"\\\" is not part of the THREE namespace! Did you forget to extend it? See: https://github.com/react-spring/react-three-fiber#using-3rd-party-non-three-namespaced-objects-in-the-scene-graph\";\n    }\n\n    instance = is.arr(args) ? _construct(target, _toConsumableArray(args)) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    var fn = function fn(node) {\n      if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      });\n      var restSiblings = parentInstance.children.filter(function (sibling) {\n        return sibling !== child;\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      var index = restSiblings.indexOf(beforeChild);\n      parentInstance.children = [].concat(_toConsumableArray(restSiblings.slice(0, index)), [child], _toConsumableArray(restSiblings.slice(index)));\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent) {\n  var clone = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    var target = clone ? _toConsumableArray(array) : array;\n    target.forEach(function (child) {\n      return removeChild(parent, child);\n    });\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      if (parentInstance.__objects) parentInstance.__objects = parentInstance.__objects.filter(function (x) {\n        return x !== child;\n      }); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n        return x !== child;\n      });else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      unstable_runWithPriority(unstable_IdlePriority, function () {\n        // Remove interactivity\n        if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(function (x) {\n          return x !== child;\n        }); // Remove nested child objects\n\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose) child.dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  var parent = instance.parent;\n  var newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(function (fiber) {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (is.fun(fiber.ref)) fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nvar Renderer = Reconciler({\n  now: unstable_now,\n  createInstance: createInstance,\n  removeChild: removeChild,\n  appendChild: appendChild,\n  insertBefore: insertBefore,\n  // @ts-ignore\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  // @ts-ignore\n  setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  // @ts-ignore\n  clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n  commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      var _newProps$args = newProps.args,\n          argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n          restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      var _oldProps$args = oldProps.args,\n          argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n          restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      var hasNewArgs = argsNew.some(function (value, index) {\n        return is.obj(value) ? Object.entries(value).some(function (_ref5) {\n          var _ref6 = _slicedToArray(_ref5, 2),\n              key = _ref6[0],\n              val = _ref6[1];\n\n          return val !== argsOld[index][key];\n        }) : value !== argsOld[index];\n      });\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n  hideInstance: function hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n  unhideInstance: function unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n  hideTextInstance: function hideTextInstance() {\n    throw new Error('Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.');\n  },\n  getPublicInstance: function getPublicInstance(instance) {\n    return instance;\n  },\n  getRootHostContext: function getRootHostContext() {\n    return emptyObject;\n  },\n  getChildHostContext: function getChildHostContext() {\n    return emptyObject;\n  },\n  createTextInstance: function createTextInstance() {},\n  finalizeInitialChildren: function finalizeInitialChildren() {\n    return false;\n  },\n  prepareUpdate: function prepareUpdate() {\n    return emptyObject;\n  },\n  shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n    return false;\n  },\n  prepareForCommit: function prepareForCommit() {},\n  resetAfterCommit: function resetAfterCommit() {},\n  shouldSetTextContent: function shouldSetTextContent() {\n    return false;\n  }\n});\nvar LegacyRoot = 0;\nvar ConcurrentRoot = 2;\nvar hasSymbol = is.fun(Symbol) && Symbol.for;\nvar REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\n\nfunction render(element, container, state) {\n  var root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    var newRoot = root = Renderer.createContainer(container, //@ts-ignore\n    state !== undefined && state.current.concurrent ? ConcurrentRoot : LegacyRoot, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, function () {\n    return undefined;\n  });\n  return Renderer.getPublicRootInstance(root);\n}\n\nfunction unmountComponentAtNode(container) {\n  var root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, function () {\n    return void roots.delete(container);\n  });\n}\n\nfunction createPortal(children, containerInfo, implementation) {\n  var key = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: containerInfo,\n    implementation: implementation\n  };\n}\n\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  //@ts-ignore\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nvar stateContext = createContext({});\n\nvar useCanvas = function useCanvas(props) {\n  var children = props.children,\n      gl = props.gl,\n      camera = props.camera,\n      orthographic = props.orthographic,\n      raycaster = props.raycaster,\n      size = props.size,\n      pixelRatio = props.pixelRatio,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$concurrent = props.concurrent,\n      concurrent = _props$concurrent === void 0 ? false : _props$concurrent,\n      _props$shadowMap = props.shadowMap,\n      shadowMap = _props$shadowMap === void 0 ? false : _props$shadowMap,\n      _props$sRGB = props.sRGB,\n      sRGB = _props$sRGB === void 0 ? false : _props$sRGB,\n      _props$colorManagemen = props.colorManagement,\n      colorManagement = _props$colorManagemen === void 0 ? false : _props$colorManagemen,\n      _props$invalidateFram = props.invalidateFrameloop,\n      invalidateFrameloop = _props$invalidateFram === void 0 ? false : _props$invalidateFram,\n      _props$updateDefaultC = props.updateDefaultCamera,\n      updateDefaultCamera = _props$updateDefaultC === void 0 ? true : _props$updateDefaultC,\n      _props$noEvents = props.noEvents,\n      noEvents = _props$noEvents === void 0 ? false : _props$noEvents,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed; // Local, reactive state\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      ready = _useState2[0],\n      setReady = _useState2[1];\n\n  var _useState3 = useState(function () {\n    return new Vector2();\n  }),\n      _useState4 = _slicedToArray(_useState3, 1),\n      mouse = _useState4[0];\n\n  var _useState5 = useState(function () {\n    var ray = new Raycaster();\n\n    if (raycaster) {\n      var raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  }),\n      _useState6 = _slicedToArray(_useState5, 1),\n      defaultRaycaster = _useState6[0];\n\n  var _useState7 = useState(function () {\n    var scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n      _useState8 = _slicedToArray(_useState7, 1),\n      defaultScene = _useState8[0];\n\n  var _useState9 = useState(function () {\n    var cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {}); // Always look at [0, 0, 0]\n\n    // Always look at [0, 0, 0]\n    cam.lookAt(0, 0, 0);\n    return cam;\n  }),\n      _useState10 = _slicedToArray(_useState9, 2),\n      defaultCam = _useState10[0],\n      _setDefaultCamera = _useState10[1];\n\n  var _useState11 = useState(function () {\n    return new Clock();\n  }),\n      _useState12 = _slicedToArray(_useState11, 1),\n      clock = _useState12[0]; // Public state\n\n\n  var state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    colorManagement: colorManagement,\n    sRGB: sRGB,\n    vr: vr,\n    concurrent: concurrent,\n    noEvents: noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse: mouse,\n    clock: clock,\n    gl: gl,\n    size: size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: function subscribe(ref) {\n      var priority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref: ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n      return function () {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(function (s) {\n          return s.ref !== ref;\n        });\n      };\n    },\n    setDefaultCamera: function setDefaultCamera(camera) {\n      return _setDefaultCamera(camera);\n    },\n    invalidate: function invalidate() {\n      return _invalidate(state);\n    },\n    intersect: function intersect() {\n      var event = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var prepare = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      return handlePointerMove(event, prepare);\n    }\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useMemo(function () {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  useMemo(function () {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(defaultCam)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      var target = new Vector3(0, 0, 0);\n      var distance = defaultCam.position.distanceTo(target);\n      var fov = defaultCam.fov * Math.PI / 180; // convert vertical fov to radians\n\n      var height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      var width = height * state.current.aspect;\n      state.current.viewport = {\n        width: width,\n        height: height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) _invalidate(state);\n  }, [defaultCam, gl, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  /** Sets up defaultRaycaster */\n\n  var prepareRay = useCallback(function (_ref7) {\n    var clientX = _ref7.clientX,\n        clientY = _ref7.clientY;\n\n    if (clientX !== void 0) {\n      var _state$current$size = state.current.size,\n          left = _state$current$size.left,\n          right = _state$current$size.right,\n          top = _state$current$size.top,\n          bottom = _state$current$size.bottom;\n      mouse.set((clientX - left) / (right - left) * 2 - 1, -((clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  var intersect = useCallback(function (event, filter) {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    var seen = new Set();\n    var hits = []; // Allow callers to eliminate event objects\n\n    var eventsObjects = filter ? filter(state.current.scene.__interaction) : state.current.scene.__interaction; // Intersect known handler objects and filter against duplicates\n\n    var intersects = defaultRaycaster.intersectObjects(eventsObjects, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) {\n      intersects = raycaster.filter(intersects, sharedState.current);\n    }\n\n    var _iterator = _createForOfIteratorHelper(intersects),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var _intersect = _step.value;\n        var eventObject = _intersect.object; // Bubble event up\n\n        while (eventObject) {\n          var handlers = eventObject.__handlers;\n          if (handlers) hits.push(_extends({}, _intersect, {\n            eventObject: eventObject\n          }));\n          eventObject = eventObject.parent;\n        }\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  var calculateDistance = useCallback(function (event) {\n    var dx = event.clientX - state.current.initialClick[0];\n    var dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  var hovered = useMemo(function () {\n    return new Map();\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  var temp = new Vector3();\n  var handleIntersects = useCallback(function (event, fn, filter) {\n    // Get fresh intersects\n    var intersections = intersect(event, filter); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(function (captured) {\n        if (!intersections.find(function (hit) {\n          return hit.eventObject === captured.eventObject;\n        })) intersections.push(captured);\n      });\n    } // If anything has been found, forward it to the event listeners\n\n\n    if (intersections.length) {\n      (function () {\n        var unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(state.current.camera);\n        var delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n        var releasePointerCapture = function releasePointerCapture(id) {\n          return event.target.releasePointerCapture(id);\n        };\n\n        var localState = {\n          stopped: false,\n          captured: false\n        };\n\n        var _iterator2 = _createForOfIteratorHelper(intersections),\n            _step2;\n\n        try {\n          var _loop = function _loop() {\n            var hit = _step2.value;\n\n            var setPointerCapture = function setPointerCapture(id) {\n              // If the hit is going to be captured flag that we're in captured state\n              if (!localState.captured) {\n                localState.captured = true; // The captured hit array is reset to collect hits\n\n                state.current.captured = [];\n              } // Push hits to the array\n\n\n              if (state.current.captured) {\n                state.current.captured.push(hit);\n              } // Call the original event now\n\n\n              event.target.setPointerCapture(id);\n            };\n\n            var raycastEvent = _extends({}, event, hit, {\n              intersections: intersections,\n              stopped: localState.stopped,\n              delta: delta,\n              unprojectedPoint: unprojectedPoint,\n              ray: defaultRaycaster.ray,\n              camera: state.current.camera,\n              // Hijack stopPropagation, which just sets a flag\n              stopPropagation: function stopPropagation() {\n                // https://github.com/react-spring/react-three-fiber/issues/596\n                // Events are not allowed to stop propagation if the pointer has been captured\n                var cap = state.current.captured;\n\n                if (!cap || cap.find(function (h) {\n                  return h.eventObject.id === hit.eventObject.id;\n                })) {\n                  raycastEvent.stopped = localState.stopped = true;\n                }\n              },\n              // Pointer-capture needs the hit, on which the user may call stopPropagation()\n              // This makes it harder to use the actual event, because then we loose the connection\n              // to the actual hit, which would mean it's picking up all intersects ...\n              target: _extends({}, event.target, {\n                setPointerCapture: setPointerCapture,\n                releasePointerCapture: releasePointerCapture\n              }),\n              currentTarget: _extends({}, event.currentTarget, {\n                setPointerCapture: setPointerCapture,\n                releasePointerCapture: releasePointerCapture\n              }),\n              sourceEvent: event\n            });\n\n            fn(raycastEvent);\n\n            if (localState.stopped === true) {\n              // Propagation is stopped, remove all other hover records\n              // An event handler is only allowed to flush other handlers if it is hovered itself\n              if (hovered.size && Array.from(hovered.values()).find(function (i) {\n                return i.object === hit.object;\n              })) {\n                handlePointerCancel(raycastEvent, [hit]);\n              }\n\n              return \"break\";\n            }\n          };\n\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var _ret = _loop();\n\n            if (_ret === \"break\") break;\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      })();\n    }\n\n    return intersections;\n  }, []);\n  var handlePointerMove = useCallback(function (event) {\n    var prepare = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    state.current.pointer.emit('pointerMove', event);\n    if (prepare) prepareRay(event);\n    var hits = handleIntersects(event, function (data) {\n      var eventObject = data.eventObject;\n      var handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        var id = makeId(data);\n        var hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends({}, data, {\n            type: 'pointerenter'\n          }));\n        } else if (hoveredItem.stopped) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }, // This is onPointerMove, we're only interested in events that exhibit this particular event\n    function (objects) {\n      return objects.filter(function (obj) {\n        return ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(function (name) {\n          return obj.__handlers['pointer' + name];\n        });\n      });\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits, prepare);\n    return hits;\n  }, []);\n  var handlePointerCancel = useCallback(function (event, hits) {\n    var prepare = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    state.current.pointer.emit('pointerCancel', event);\n    if (prepare) prepareRay(event);\n    if (!hits) hits = handleIntersects(event, function () {\n      return null;\n    });\n    Array.from(hovered.values()).forEach(function (data) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(function (i) {\n        return i.eventObject === data.eventObject;\n      }))) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n\n        hovered.delete(makeId(data));\n      }\n    });\n  }, []);\n  var handlePointer = useCallback(function (name) {\n    return function (event) {\n      var prepare = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      state.current.pointer.emit(name, event);\n      if (prepare) prepareRay(event);\n      var hits = handleIntersects(event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers && handlers[name]) {\n          // Forward all events back to their respective handlers with the exception of click events,\n          // which must use the initial target\n          if (name !== 'click' && name !== 'contextMenu' && name !== 'doubleClick' || state.current.initialHits.includes(eventObject)) {\n            handlers[name](data);\n          }\n        }\n      }); // If a click yields no results, pass it back to the user as a miss\n\n      if (name === 'pointerDown') {\n        state.current.initialClick = [event.clientX, event.clientY];\n        state.current.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      }\n\n      if ((name === 'click' || name === 'contextMenu' || name === 'doubleClick') && !hits.length && onPointerMissed) {\n        if (calculateDistance(event) <= 2) onPointerMissed();\n      }\n    };\n  }, [onPointerMissed]);\n  useMemo(function () {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onContextMenu: handlePointer('contextMenu'),\n      onDoubleClick: handlePointer('doubleClick'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: function onPointerLeave(e) {\n        return handlePointerCancel(e, []);\n      },\n      onPointerMove: handlePointerMove,\n      // onGotPointerCapture is not needed any longer because the behaviour is hacked into\n      // the event itself (see handleIntersects). But in order for non-web targets to simulate\n      // it we keep the legacy event, which simply flags all current intersects as captured\n      onGotPointerCaptureLegacy: function onGotPointerCaptureLegacy(e) {\n        return state.current.captured = intersect(e);\n      },\n      onLostPointerCapture: function onLostPointerCapture(e) {\n        return state.current.captured = undefined, handlePointerCancel(e);\n      }\n    };\n  }, [onPointerMissed]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  var sharedState = useRef();\n  useMemo(function () {\n    var _state$current = state.current,\n        props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  useLayoutEffect(function () {\n    return void (pixelRatio && gl.setPixelRatio(pixelRatio));\n  }, [pixelRatio]); // Update shadow map\n\n  useLayoutEffect(function () {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl.shadowMap, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n\n    if (sRGB || colorManagement) {\n      gl.toneMapping = ACESFilmicToneMapping;\n      gl.outputEncoding = sRGBEncoding;\n    }\n  }, [shadowMap, sRGB, colorManagement]); // This component is a bridge into the three render context, when it gets rendered\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  var Canvas = useCallback(function Canvas(props) {\n    var activate = function activate() {\n      return setReady(true);\n    }; // eslint-disable-next-line react-hooks/rules-of-hooks\n\n\n    useEffect(function () {\n      var result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return props.children;\n  }, []); // Render v-dom into scene\n\n  useLayoutEffect(function () {\n    render( /*#__PURE__*/createElement(Canvas, null, /*#__PURE__*/createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(function () {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        _invalidate(state);\n      } else if ((gl.xr || gl.vr) && gl.setAnimationLoop) {\n        (gl.xr || gl.vr).enabled = true;\n        gl.setAnimationLoop(function (t) {\n          return renderGl(state, t, 0, true);\n        });\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready, invalidateFrameloop]); // Dispose renderer on unmount\n\n  useEffect(function () {\n    return function () {\n      if (state.current.gl) {\n        if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n        if (state.current.gl.dispose) state.current.gl.dispose();\n        state.current.gl = undefined;\n        unmountComponentAtNode(state.current.scene);\n        state.current.active = false;\n      }\n    };\n  }, []);\n  return state.current.events;\n};\n\nfunction useContext(context) {\n  var result = useContext$1(context);\n\n  if (!result) {\n    console.warn('hooks can only be used within the canvas! https://github.com/react-spring/react-three-fiber#hooks');\n  }\n\n  return result;\n}\n\nfunction useFrame(callback) {\n  var renderPriority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n  var _useContext = useContext(stateContext),\n      subscribe = _useContext.subscribe; // Update ref\n\n\n  var ref = useRef(callback);\n  useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  useEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority]);\n  return null;\n}\n\nfunction useThree() {\n  return useContext(stateContext);\n}\n\nfunction useUpdate(callback, dependents, optionalRef) {\n  var _useContext2 = useContext(stateContext),\n      invalidate = _useContext2.invalidate;\n\n  var localRef = useRef();\n  var ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(function () {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\n\nfunction useResource(optionalRef) {\n  var _useState13 = useState(false),\n      _useState14 = _slicedToArray(_useState13, 2),\n      _ = _useState14[0],\n      forceUpdate = _useState14[1];\n\n  var localRef = useRef(undefined);\n  var ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(function () {\n    return void forceUpdate(function (i) {\n      return !i;\n    });\n  }, [ref.current]);\n  return [ref, ref.current];\n}\n\nvar blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  var reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(function (name) {\n    return delete reducedProps[name];\n  }); // Remove functions\n\n  Object.keys(reducedProps).forEach(function (name) {\n    return typeof reducedProps[name] === 'function' && delete reducedProps[name];\n  }); // Prune materials and geometries\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  var loader = useMemo(function () {\n    // Construct new loader\n    var temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  var results = usePromise(function (Proto, url) {\n    var urlArray = Array.isArray(url) ? url : [url];\n    return Promise.all(urlArray.map(function (url) {\n      return new Promise(function (res) {\n        return loader.load(url, function (data) {\n          if (data.scene) {\n            // This has to be deprecated at some point!\n            data.__$ = []; // Nodes and materials are better\n\n            data.nodes = {};\n            data.materials = {};\n            data.scene.traverse(function (obj) {\n              data.__$.push(prune(obj));\n\n              if (obj.name) data.nodes = _extends({}, data.nodes, _defineProperty({}, obj.name, obj));\n              if (obj.material && !data.materials[obj.material.name]) data.materials[obj.material.name] = obj.material;\n            });\n          }\n\n          res(data);\n        });\n      });\n    }));\n  }, [Proto, url]); // Return the object/s\n\n  return Array.isArray(url) ? results : results[0];\n}\n\nvar useCamera = function useCamera() {\n  console.warn('The useCamera hook was moved to: https://github.com/react-spring/drei');\n  return null;\n};\n\nvar defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content(_ref) {\n  var children = _ref.children,\n      setEvents = _ref.setEvents,\n      container = _ref.container,\n      renderer = _ref.renderer,\n      effects = _ref.effects,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\", \"setEvents\", \"container\", \"renderer\", \"effects\"]); // Create renderer\n\n\n  var _useState15 = useState(renderer),\n      _useState16 = _slicedToArray(_useState15, 1),\n      gl = _useState16[0];\n\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount managemenbt\n\n  useEffect(function () {\n    return effects && effects(gl, container);\n  }, []); // Init canvas, fetch events, hand them back to the wrapping div\n\n  var events = useCanvas(_extends({}, props, {\n    children: children,\n    gl: gl\n  }));\n  useEffect(function () {\n    return void setEvents(events);\n  }, [events]);\n  return null;\n}\n\nvar ResizeContainer = React__default.memo(function ResizeContainer(props) {\n  var preRender = props.preRender,\n      resize = props.resize,\n      style = props.style,\n      restSpread = _objectWithoutPropertiesLoose(props, [\"renderer\", \"effects\", \"children\", \"vr\", \"gl2\", \"concurrent\", \"shadowMap\", \"sRGB\", \"colorManagement\", \"orthographic\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"onCreated\", \"onPointerMissed\", \"preRender\", \"resize\", \"style\"]);\n\n  var containerRef = useRef(); // onGotPointerCaptureLegacy is a fake event used by non-web targets to simulate poinzter capture\n\n  var _useState17 = useState({}),\n      _useState18 = _slicedToArray(_useState17, 2),\n      _ref2 = _useState18[0],\n      setEvents = _useState18[1];\n\n  var events = _objectWithoutPropertiesLoose(_ref2, [\"onGotPointerCaptureLegacy\"]);\n\n  var _useMeasure = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: typeof window === 'undefined' || !window.ResizeObserver ? ResizeObserver : undefined\n  }),\n      _useMeasure2 = _slicedToArray(_useMeasure, 2),\n      bind = _useMeasure2[0],\n      size = _useMeasure2[1]; // Flag view ready once it's been measured out\n\n\n  var readyFlag = useRef(false);\n  var ready = useMemo(function () {\n    return readyFlag.current = readyFlag.current || !!size.width && !!size.height;\n  }, [size]);\n  var state = useMemo(function () {\n    return {\n      size: size,\n      setEvents: setEvents,\n      container: containerRef.current\n    };\n  }, [size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') return /*#__PURE__*/React__default.createElement(\"div\", _extends({\n    style: _extends({}, defaultStyles, style)\n  }, restSpread), preRender); // Render the canvas into the dom\n\n  return /*#__PURE__*/React__default.createElement(\"div\", _extends({\n    ref: mergeRefs([bind, containerRef]),\n    style: _extends({}, defaultStyles, style)\n  }, events, restSpread), preRender, ready && /*#__PURE__*/React__default.createElement(Content, _extends({}, props, state)));\n});\nvar Canvas = React__default.memo(function Canvas(_ref) {\n  var children = _ref.children,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\"]);\n\n  var canvasRef = useRef();\n  return /*#__PURE__*/React__default.createElement(ResizeContainer, _extends({}, props, {\n    renderer: function renderer() {\n      if (canvasRef.current) {\n        var params = _extends({\n          antialias: true,\n          alpha: true\n        }, props.gl);\n\n        var temp = new WebGLRenderer(_extends({\n          powerPreference: 'high-performance',\n          //stencil: false,\n          //depth: false,\n          canvas: canvasRef.current,\n          context: props.gl2 ? canvasRef.current.getContext('webgl2', params) : undefined\n        }, params));\n        return temp;\n      }\n    },\n    preRender: /*#__PURE__*/React__default.createElement(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'block'\n      }\n    })\n  }), children);\n});\n\nvar Dom = function Dom() {\n  console.warn('The experimental <Dom> component was renamed to <HTML> and moved to: https://github.com/react-spring/drei');\n  return null;\n};\n\nexport { Canvas, Dom, Renderer, addAfterEffect, addEffect, addTail, applyProps, createPortal, extend, _invalidate as invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCamera, useCanvas, useFrame, useLoader, useResource, useThree, useUpdate };","map":{"version":3,"sources":["/Users/alberto.ramos/Documents/Personal/GitHub/Website3D/node_modules/react-three-fiber/web.js"],"names":["_extends","_objectWithoutPropertiesLoose","THREE","Layers","Color","Texture","sRGBEncoding","Vector2","Raycaster","Scene","OrthographicCamera","PerspectiveCamera","Clock","Vector3","PCFSoftShadowMap","ACESFilmicToneMapping","WebGLRenderer","Reconciler","unstable_now","unstable_runWithPriority","unstable_IdlePriority","React__default","createContext","useState","useRef","useMemo","useCallback","useLayoutEffect","useEffect","createElement","useContext","useContext$1","TinyEmitter","usePromise","useMeasure","ResizeObserver","mergeRefs","version","_toPropertyKey","arg","key","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","roots","Map","emptyObject","is","obj","a","Object","arr","fun","str","num","und","Array","isArray","equ","b","i","createSubs","callback","subs","index","length","push","splice","globalEffects","globalAfterEffects","globalTailEffects","addEffect","addAfterEffect","addTail","renderGl","state","timestamp","repeat","runGlobalEffects","forEach","effect","delta","current","clock","getDelta","subscribers","sub","ref","frames","Math","max","invalidateFrameloop","manual","gl","render","scene","camera","running","renderLoop","root","containerInfo","__state","active","ready","requestAnimationFrame","invalidate","vr","catalogue","extend","objects","applyProps","instance","newProps","oldProps","accumulative","container","__container","sameProps","keys","filter","handlers","startsWith","includes","leftOvers","toFilter","__instance","filteredProps","reduce","acc","prop","rest","map","entries","value","_instance$__container","target","split","set","reverse","name","reverseEntries","isColorManagement","colorManagement","copy","constructor","convertSRGBToLinear","encoding","invalidateInstance","raycast","__handlers","__interaction","indexOf","charAt","toLowerCase","substr","parent","updateInstance","onUpdate","createInstance","type","_ref","hostContext","internalInstanceHandle","args","props","toUpperCase","slice","object","has","fn","node","return","stateNode","__objects","appendChild","parentInstance","child","isObject3D","add","attach","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","restSiblings","children","sibling","removeRecursive","array","clone","removeChild","remove","x","dispose","switchInstance","fiber","newInstance","alternate","Renderer","now","warnsIfNotActing","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","noTimeout","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","argsNew","restNew","argsOld","restOld","hasNewArgs","some","val","hideInstance","visible","unhideInstance","hideTextInstance","Error","getPublicInstance","getRootHostContext","getChildHostContext","createTextInstance","finalizeInitialChildren","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","resetAfterCommit","shouldSetTextContent","LegacyRoot","ConcurrentRoot","hasSymbol","for","REACT_PORTAL_TYPE","element","get","newRoot","createContainer","concurrent","updateContainer","getPublicRootInstance","unmountComponentAtNode","delete","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","process","env","NODE_ENV","rendererPackageName","findHostInstanceByFiber","findHostInstance","isOrthographicCamera","def","makeId","event","eventObject","uuid","stateContext","useCanvas","orthographic","raycaster","size","pixelRatio","shadowMap","sRGB","updateDefaultCamera","noEvents","onCreated","onPointerMissed","setReady","mouse","ray","raycasterProps","defaultRaycaster","defaultScene","cam","position","z","lookAt","defaultCam","_setDefaultCamera","aspect","viewport","width","height","factor","initialClick","initialHits","pointer","captured","events","subscribe","priority","sort","s","setDefaultCamera","intersect","prepare","handlePointerMove","distance","distanceTo","fov","PI","tan","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setSize","prepareRay","clientX","clientY","setFromCamera","seen","Set","hits","eventsObjects","intersects","intersectObjects","item","id","sharedState","calculateDistance","dx","dy","round","sqrt","hovered","temp","handleIntersects","intersections","find","hit","unprojectedPoint","y","unproject","releasePointerCapture","localState","stopped","setPointerCapture","raycastEvent","stopPropagation","cap","h","currentTarget","sourceEvent","from","values","handlePointerCancel","emit","data","pointerMove","pointerOver","pointerEnter","pointerOut","pointerLeave","hoveredItem","handlePointer","onClick","onContextMenu","onDoubleClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","e","onPointerMove","onGotPointerCaptureLegacy","onLostPointerCapture","_state$current","setPixelRatio","enabled","assign","toneMapping","outputEncoding","Canvas","activate","result","then","Provider","xr","setAnimationLoop","t","console","warn","forceContextLoss","context","useFrame","renderPriority","unsubscribe","useThree","useUpdate","dependents","optionalRef","localRef","useResource","_","forceUpdate","blackList","prune","reducedProps","material","geometry","useLoader","Proto","url","extensions","loader","results","urlArray","Promise","all","load","__$","nodes","materials","traverse","useCamera","defaultStyles","overflow","Content","setEvents","renderer","effects","ResizeContainer","memo","preRender","resize","style","restSpread","containerRef","_ref2","scroll","debounce","polyfill","window","bind","readyFlag","canvasRef","params","antialias","alpha","powerPreference","canvas","gl2","getContext","display","Dom"],"mappings":"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","sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport * as THREE from 'three';\nimport { Layers, Color, Texture, sRGBEncoding, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, Vector3, PCFSoftShadowMap, ACESFilmicToneMapping, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport React__default, { createContext, useState, useRef, useMemo, useCallback, useLayoutEffect, useEffect, createElement, useContext as useContext$1 } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport usePromise from 'react-promise-suspense';\nimport useMeasure from 'react-use-measure';\nimport { ResizeObserver } from '@juggle/resize-observer';\nimport mergeRefs from 'react-merge-refs';\n\nvar version = \"4.2.21\";\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a) && !is.arr(a),\n  fun: a => typeof a === 'function',\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\n\nfunction createSubs(callback, subs) {\n  const index = subs.length;\n  subs.push(callback);\n  return () => void subs.splice(index, 1);\n}\n\nlet globalEffects = [];\nlet globalAfterEffects = [];\nlet globalTailEffects = [];\nconst addEffect = callback => createSubs(callback, globalEffects);\nconst addAfterEffect = callback => createSubs(callback, globalAfterEffects);\nconst addTail = callback => createSubs(callback, globalTailEffects);\nfunction renderGl(state, timestamp, repeat = 0, runGlobalEffects = false) {\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(effect => effect(timestamp) && repeat++); // Run local effects\n\n  const delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(sub => sub.ref.current(state.current, delta)); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera); // Run global effects\n\n  if (runGlobalEffects) globalAfterEffects.forEach(effect => effect(timestamp));\n  return repeat;\n}\nlet running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  let repeat = 0; // Run global effects\n\n  globalEffects.forEach(effect => effect(timestamp) && repeat++);\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  }); // Run global after-effects\n\n  globalAfterEffects.forEach(effect => effect(timestamp));\n  if (repeat !== 0) return requestAnimationFrame(renderLoop);else {\n    // Tail call effects, they are called when rendering stops\n    globalTailEffects.forEach(effect => effect(timestamp));\n  } // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state = true, frames = 2) {\n  if (state === true) roots.forEach(root => root.containerInfo.__state.current.frames = frames);else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\nlet catalogue = {};\nconst extend = objects => void (catalogue = _extends({}, catalogue, objects));\nfunction applyProps(instance, newProps, oldProps = {}, accumulative = false) {\n  // Filter equals, events and reserved props\n  const container = instance.__container;\n  const sameProps = Object.keys(newProps).filter(key => is.equ(newProps[key], oldProps[key]));\n  const handlers = Object.keys(newProps).filter(key => {\n    // Event-handlers ...\n    //   are functions, that\n    //   start with \"on\", and\n    //   contain the name \"Pointer\", \"Click\", \"ContextMenu\", or \"Wheel\"\n    if (is.fun(newProps[key]) && key.startsWith('on')) {\n      return key.includes('Pointer') || key.includes('Click') || key.includes('ContextMenu') || key.includes('Wheel');\n    }\n  });\n  const leftOvers = accumulative ? Object.keys(oldProps).filter(key => newProps[key] === void 0) : [];\n  const toFilter = [...sameProps, 'children', 'key', 'ref']; // Instances use \"object\" as a reserved identifier\n\n  if (instance.__instance) toFilter.push('object');\n  const filteredProps = toFilter.reduce((acc, prop) => {\n    let rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(key => key !== 'children' && (filteredProps[key] = undefined));\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach(([key, value]) => {\n      if (!handlers.includes(key)) {\n        var _instance$__container;\n\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const [name, ...reverseEntries] = entries.reverse();\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        const isColorManagement = (_instance$__container = instance.__container) == null ? void 0 : _instance$__container.__state.current.colorManagement;\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          // If value is an array it has got to be the set function\n          if (Array.isArray(value)) target.set(...value); // Test again target.copy(class) next ...\n          else if (target.copy && value && value.constructor && target.constructor.name === value.constructor.name) target.copy(value); // If nothing else fits, just set the single value, ignore undefined\n            // https://github.com/react-spring/react-three-fiber/issues/274\n            else if (value !== undefined) {\n                target.set(value); // Auto-convert sRGB colors, for now ...\n                // https://github.com/react-spring/react-three-fiber/issues/344\n\n                if (isColorManagement && target instanceof Color) {\n                  target.convertSRGBToLinear();\n                }\n              } // Else, just overwrite the value\n        } else {\n          root[key] = value; // Auto-convert sRGB textures, for now ...\n          // https://github.com/react-spring/react-three-fiber/issues/344\n\n          if (isColorManagement && root[key] instanceof Texture) {\n            root[key].encoding = sRGBEncoding;\n          }\n        }\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      const index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) container.__interaction.push(instance); // Add handlers to the instances handler-map\n\n      instance.__handlers = handlers.reduce((acc, key) => _extends({}, acc, {\n        [key.charAt(2).toLowerCase() + key.substr(3)]: newProps[key]\n      }), {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.onUpdate) instance.onUpdate(instance);\n}\n\nfunction createInstance(type, _ref, container, hostContext, internalInstanceHandle) {\n  let {\n    args = []\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"args\"]);\n\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else if (type === 'new') {\n    instance = new props.object(args);\n  } else {\n    const target = catalogue[name] || THREE[name];\n\n    if (!target) {\n      throw \"\\\"\" + name + \"\\\" is not part of the THREE namespace! Did you forget to extend it? See: https://github.com/react-spring/react-three-fiber#using-3rd-party-non-three-namespaced-objects-in-the-scene-graph\";\n    }\n\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    const fn = node => {\n      if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      });\n      const restSiblings = parentInstance.children.filter(sibling => sibling !== child); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = restSiblings.indexOf(beforeChild);\n      parentInstance.children = [...restSiblings.slice(0, index), child, ...restSiblings.slice(index)];\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone = false) {\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array;\n    target.forEach(child => removeChild(parent, child));\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      if (parentInstance.__objects) parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      unstable_runWithPriority(unstable_IdlePriority, () => {\n        // Remove interactivity\n        if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(x => x !== child); // Remove nested child objects\n\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose) child.dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  const parent = instance.parent;\n  const newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(fiber => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (is.fun(fiber.ref)) fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  // @ts-ignore\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  // @ts-ignore\n  setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  // @ts-ignore\n  clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const {\n        args: argsNew = []\n      } = newProps,\n            restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      const {\n        args: argsOld = []\n      } = oldProps,\n            restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some(([key, val]) => val !== argsOld[index][key]) : value !== argsOld[index]);\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n\n  hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n\n  unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n\n  hideTextInstance() {\n    throw new Error('Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.');\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext() {\n    return emptyObject;\n  },\n\n  getChildHostContext() {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren() {\n    return false;\n  },\n\n  prepareUpdate() {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree() {\n    return false;\n  },\n\n  prepareForCommit() {},\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent() {\n    return false;\n  }\n\n});\nconst LegacyRoot = 0;\nconst ConcurrentRoot = 2;\nconst hasSymbol = is.fun(Symbol) && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    let newRoot = root = Renderer.createContainer(container, //@ts-ignore\n    state !== undefined && state.current.concurrent ? ConcurrentRoot : LegacyRoot, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, () => undefined);\n  return Renderer.getPublicRootInstance(root);\n}\nfunction unmountComponentAtNode(container) {\n  const root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, () => void roots.delete(container));\n}\nfunction createPortal(children, containerInfo, implementation, key = null) {\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation\n  };\n}\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  //@ts-ignore\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nconst stateContext = createContext({});\nconst useCanvas = props => {\n  const {\n    children,\n    gl,\n    camera,\n    orthographic,\n    raycaster,\n    size,\n    pixelRatio,\n    vr = false,\n    concurrent = false,\n    shadowMap = false,\n    sRGB = false,\n    colorManagement = false,\n    invalidateFrameloop = false,\n    updateDefaultCamera = true,\n    noEvents = false,\n    onCreated,\n    onPointerMissed\n  } = props; // Local, reactive state\n\n  const [ready, setReady] = useState(false);\n  const [mouse] = useState(() => new Vector2());\n  const [defaultRaycaster] = useState(() => {\n    const ray = new Raycaster();\n\n    if (raycaster) {\n      const raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  });\n  const [defaultScene] = useState(() => {\n    const scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  });\n  const [defaultCam, _setDefaultCamera] = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {}); // Always look at [0, 0, 0]\n\n    cam.lookAt(0, 0, 0);\n    return cam;\n  });\n  const [clock] = useState(() => new Clock()); // Public state\n\n  const state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    colorManagement,\n    sRGB,\n    vr,\n    concurrent,\n    noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse,\n    clock,\n    gl,\n    size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: (ref, priority = 0) => {\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort((a, b) => a.priority - b.priority);\n      return () => {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(s => s.ref !== ref);\n      };\n    },\n    setDefaultCamera: camera => _setDefaultCamera(camera),\n    invalidate: () => invalidate(state),\n    intersect: (event = {}, prepare = true) => handlePointerMove(event, prepare)\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useMemo(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  useMemo(() => {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(defaultCam)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      const target = new Vector3(0, 0, 0);\n      const distance = defaultCam.position.distanceTo(target);\n      const fov = defaultCam.fov * Math.PI / 180; // convert vertical fov to radians\n\n      const height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const width = height * state.current.aspect;\n      state.current.viewport = {\n        width,\n        height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state);\n  }, [defaultCam, gl, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(({\n    clientX,\n    clientY\n  }) => {\n    if (clientX !== void 0) {\n      const {\n        left,\n        right,\n        top,\n        bottom\n      } = state.current.size;\n      mouse.set((clientX - left) / (right - left) * 2 - 1, -((clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback((event, filter) => {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    const seen = new Set();\n    const hits = []; // Allow callers to eliminate event objects\n\n    const eventsObjects = filter ? filter(state.current.scene.__interaction) : state.current.scene.__interaction; // Intersect known handler objects and filter against duplicates\n\n    let intersects = defaultRaycaster.intersectObjects(eventsObjects, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) {\n      intersects = raycaster.filter(intersects, sharedState.current);\n    }\n\n    for (let intersect of intersects) {\n      let eventObject = intersect.object; // Bubble event up\n\n      while (eventObject) {\n        const handlers = eventObject.__handlers;\n        if (handlers) hits.push(_extends({}, intersect, {\n          eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  const calculateDistance = useCallback(event => {\n    let dx = event.clientX - state.current.initialClick[0];\n    let dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  const hovered = useMemo(() => new Map(), []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const temp = new Vector3();\n  const handleIntersects = useCallback((event, fn, filter) => {\n    // Get fresh intersects\n    let intersections = intersect(event, filter); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(captured => {\n        if (!intersections.find(hit => hit.eventObject === captured.eventObject)) intersections.push(captured);\n      });\n    } // If anything has been found, forward it to the event listeners\n\n\n    if (intersections.length) {\n      const unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(state.current.camera);\n      const delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      const releasePointerCapture = id => event.target.releasePointerCapture(id);\n\n      const localState = {\n        stopped: false,\n        captured: false\n      };\n\n      for (let hit of intersections) {\n        const setPointerCapture = id => {\n          // If the hit is going to be captured flag that we're in captured state\n          if (!localState.captured) {\n            localState.captured = true; // The captured hit array is reset to collect hits\n\n            state.current.captured = [];\n          } // Push hits to the array\n\n\n          if (state.current.captured) {\n            state.current.captured.push(hit);\n          } // Call the original event now\n          event.target.setPointerCapture(id);\n        };\n\n        let raycastEvent = _extends({}, event, hit, {\n          intersections,\n          stopped: localState.stopped,\n          delta,\n          unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          camera: state.current.camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => {\n            // https://github.com/react-spring/react-three-fiber/issues/596\n            // Events are not allowed to stop propagation if the pointer has been captured\n            const cap = state.current.captured;\n\n            if (!cap || cap.find(h => h.eventObject.id === hit.eventObject.id)) {\n              raycastEvent.stopped = localState.stopped = true;\n            }\n          },\n          // Pointer-capture needs the hit, on which the user may call stopPropagation()\n          // This makes it harder to use the actual event, because then we loose the connection\n          // to the actual hit, which would mean it's picking up all intersects ...\n          target: _extends({}, event.target, {\n            setPointerCapture,\n            releasePointerCapture\n          }),\n          currentTarget: _extends({}, event.currentTarget, {\n            setPointerCapture,\n            releasePointerCapture\n          }),\n          sourceEvent: event\n        });\n\n        fn(raycastEvent);\n\n        if (localState.stopped === true) {\n          // Propagation is stopped, remove all other hover records\n          // An event handler is only allowed to flush other handlers if it is hovered itself\n          if (hovered.size && Array.from(hovered.values()).find(i => i.object === hit.object)) {\n            handlePointerCancel(raycastEvent, [hit]);\n          }\n\n          break;\n        }\n      }\n    }\n\n    return intersections;\n  }, []);\n  const handlePointerMove = useCallback((event, prepare = true) => {\n    state.current.pointer.emit('pointerMove', event);\n    if (prepare) prepareRay(event);\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        const id = makeId(data);\n        const hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends({}, data, {\n            type: 'pointerenter'\n          }));\n        } else if (hoveredItem.stopped) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }, // This is onPointerMove, we're only interested in events that exhibit this particular event\n    objects => objects.filter(obj => ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(name => obj.__handlers['pointer' + name]))); // Take care of unhover\n\n    handlePointerCancel(event, hits, prepare);\n    return hits;\n  }, []);\n  const handlePointerCancel = useCallback((event, hits, prepare = true) => {\n    state.current.pointer.emit('pointerCancel', event);\n    if (prepare) prepareRay(event);\n    if (!hits) hits = handleIntersects(event, () => null);\n    Array.from(hovered.values()).forEach(data => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(i => i.eventObject === data.eventObject))) {\n        const eventObject = data.eventObject;\n        const handlers = eventObject.__handlers;\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n\n        hovered.delete(makeId(data));\n      }\n    });\n  }, []);\n  const handlePointer = useCallback(name => (event, prepare = true) => {\n    state.current.pointer.emit(name, event);\n    if (prepare) prepareRay(event);\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers;\n\n      if (handlers && handlers[name]) {\n        // Forward all events back to their respective handlers with the exception of click events,\n        // which must use the initial target\n        if (name !== 'click' && name !== 'contextMenu' && name !== 'doubleClick' || state.current.initialHits.includes(eventObject)) {\n          handlers[name](data);\n        }\n      }\n    }); // If a click yields no results, pass it back to the user as a miss\n\n    if (name === 'pointerDown') {\n      state.current.initialClick = [event.clientX, event.clientY];\n      state.current.initialHits = hits.map(hit => hit.eventObject);\n    }\n\n    if ((name === 'click' || name === 'contextMenu' || name === 'doubleClick') && !hits.length && onPointerMissed) {\n      if (calculateDistance(event) <= 2) onPointerMissed();\n    }\n  }, [onPointerMissed]);\n  useMemo(() => {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onContextMenu: handlePointer('contextMenu'),\n      onDoubleClick: handlePointer('doubleClick'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: e => handlePointerCancel(e, []),\n      onPointerMove: handlePointerMove,\n      // onGotPointerCapture is not needed any longer because the behaviour is hacked into\n      // the event itself (see handleIntersects). But in order for non-web targets to simulate\n      // it we keep the legacy event, which simply flags all current intersects as captured\n      onGotPointerCaptureLegacy: e => state.current.captured = intersect(e),\n      onLostPointerCapture: e => (state.current.captured = undefined, handlePointerCancel(e))\n    };\n  }, [onPointerMissed]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  const sharedState = useRef();\n  useMemo(() => {\n    const _state$current = state.current,\n          props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  useLayoutEffect(() => void (pixelRatio && gl.setPixelRatio(pixelRatio)), [pixelRatio]); // Update shadow map\n\n  useLayoutEffect(() => {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl.shadowMap, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n\n    if (sRGB || colorManagement) {\n      gl.toneMapping = ACESFilmicToneMapping;\n      gl.outputEncoding = sRGBEncoding;\n    }\n  }, [shadowMap, sRGB, colorManagement]); // This component is a bridge into the three render context, when it gets rendered\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const Canvas = useCallback(function Canvas(props) {\n    const activate = () => setReady(true); // eslint-disable-next-line react-hooks/rules-of-hooks\n\n\n    useEffect(() => {\n      const result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return props.children;\n  }, []); // Render v-dom into scene\n\n  useLayoutEffect(() => {\n    render( /*#__PURE__*/createElement(Canvas, null, /*#__PURE__*/createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(() => {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state);\n      } else if ((gl.xr || gl.vr) && gl.setAnimationLoop) {\n        (gl.xr || gl.vr).enabled = true;\n        gl.setAnimationLoop(t => renderGl(state, t, 0, true));\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready, invalidateFrameloop]); // Dispose renderer on unmount\n\n  useEffect(() => () => {\n    if (state.current.gl) {\n      if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n      if (state.current.gl.dispose) state.current.gl.dispose();\n      state.current.gl = undefined;\n      unmountComponentAtNode(state.current.scene);\n      state.current.active = false;\n    }\n  }, []);\n  return state.current.events;\n};\n\nfunction useContext(context) {\n  let result = useContext$1(context);\n\n  if (!result) {\n    console.warn('hooks can only be used within the canvas! https://github.com/react-spring/react-three-fiber#hooks');\n  }\n\n  return result;\n}\n\nfunction useFrame(callback, renderPriority = 0) {\n  const {\n    subscribe\n  } = useContext(stateContext); // Update ref\n\n  const ref = useRef(callback);\n  useLayoutEffect(() => void (ref.current = callback), [callback]); // Subscribe/unsub\n\n  useEffect(() => {\n    const unsubscribe = subscribe(ref, renderPriority);\n    return () => unsubscribe();\n  }, [renderPriority]);\n  return null;\n}\nfunction useThree() {\n  return useContext(stateContext);\n}\nfunction useUpdate(callback, dependents, optionalRef) {\n  const {\n    invalidate\n  } = useContext(stateContext);\n  const localRef = useRef();\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\nfunction useResource(optionalRef) {\n  const [_, forceUpdate] = useState(false);\n  const localRef = useRef(undefined);\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => void forceUpdate(i => !i), [ref.current]);\n  return [ref, ref.current];\n}\nconst blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  const reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(name => delete reducedProps[name]); // Remove functions\n\n  Object.keys(reducedProps).forEach(name => typeof reducedProps[name] === 'function' && delete reducedProps[name]); // Prune materials and geometries\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  const loader = useMemo(() => {\n    // Construct new loader\n    const temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  const results = usePromise((Proto, url) => {\n    const urlArray = Array.isArray(url) ? url : [url];\n    return Promise.all(urlArray.map(url => new Promise(res => loader.load(url, data => {\n      if (data.scene) {\n        // This has to be deprecated at some point!\n        data.__$ = []; // Nodes and materials are better\n\n        data.nodes = {};\n        data.materials = {};\n        data.scene.traverse(obj => {\n          data.__$.push(prune(obj));\n\n          if (obj.name) data.nodes = _extends({}, data.nodes, {\n            [obj.name]: obj\n          });\n          if (obj.material && !data.materials[obj.material.name]) data.materials[obj.material.name] = obj.material;\n        });\n      }\n\n      res(data);\n    }))));\n  }, [Proto, url]); // Return the object/s\n\n  return Array.isArray(url) ? results : results[0];\n}\nconst useCamera = () => {\n  console.warn('The useCamera hook was moved to: https://github.com/react-spring/drei');\n  return null;\n};\n\nconst defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content(_ref) {\n  let {\n    children,\n    setEvents,\n    container,\n    renderer,\n    effects\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\", \"setEvents\", \"container\", \"renderer\", \"effects\"]);\n\n  // Create renderer\n  const [gl] = useState(renderer);\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount managemenbt\n\n  useEffect(() => effects && effects(gl, container), []); // Init canvas, fetch events, hand them back to the wrapping div\n\n  const events = useCanvas(_extends({}, props, {\n    children,\n    gl: gl\n  }));\n  useEffect(() => void setEvents(events), [events]);\n  return null;\n}\n\nconst ResizeContainer = React__default.memo(function ResizeContainer(props) {\n  const {\n    preRender,\n    resize,\n    style\n  } = props,\n        restSpread = _objectWithoutPropertiesLoose(props, [\"renderer\", \"effects\", \"children\", \"vr\", \"gl2\", \"concurrent\", \"shadowMap\", \"sRGB\", \"colorManagement\", \"orthographic\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"onCreated\", \"onPointerMissed\", \"preRender\", \"resize\", \"style\"]);\n\n  const containerRef = useRef(); // onGotPointerCaptureLegacy is a fake event used by non-web targets to simulate poinzter capture\n\n  const [_ref2, setEvents] = useState({});\n\n  const events = _objectWithoutPropertiesLoose(_ref2, [\"onGotPointerCaptureLegacy\"]);\n\n  const [bind, size] = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: typeof window === 'undefined' || !window.ResizeObserver ? ResizeObserver : undefined\n  }); // Flag view ready once it's been measured out\n\n  const readyFlag = useRef(false);\n  const ready = useMemo(() => readyFlag.current = readyFlag.current || !!size.width && !!size.height, [size]);\n  const state = useMemo(() => ({\n    size,\n    setEvents,\n    container: containerRef.current\n  }), [size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') return /*#__PURE__*/React__default.createElement(\"div\", _extends({\n    style: _extends({}, defaultStyles, style)\n  }, restSpread), preRender); // Render the canvas into the dom\n\n  return /*#__PURE__*/React__default.createElement(\"div\", _extends({\n    ref: mergeRefs([bind, containerRef]),\n    style: _extends({}, defaultStyles, style)\n  }, events, restSpread), preRender, ready && /*#__PURE__*/React__default.createElement(Content, _extends({}, props, state)));\n});\n\nconst Canvas = React__default.memo(function Canvas(_ref) {\n  let {\n    children\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\"]);\n\n  const canvasRef = useRef();\n  return /*#__PURE__*/React__default.createElement(ResizeContainer, _extends({}, props, {\n    renderer: () => {\n      if (canvasRef.current) {\n        const params = _extends({\n          antialias: true,\n          alpha: true\n        }, props.gl);\n\n        const temp = new WebGLRenderer(_extends({\n          powerPreference: 'high-performance',\n          //stencil: false,\n          //depth: false,\n          canvas: canvasRef.current,\n          context: props.gl2 ? canvasRef.current.getContext('webgl2', params) : undefined\n        }, params));\n        return temp;\n      }\n    },\n    preRender: /*#__PURE__*/React__default.createElement(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'block'\n      }\n    })\n  }), children);\n});\nconst Dom = () => {\n  console.warn('The experimental <Dom> component was renamed to <HTML> and moved to: https://github.com/react-spring/drei');\n  return null;\n};\n\nexport { Canvas, Dom, Renderer, addAfterEffect, addEffect, addTail, applyProps, createPortal, extend, invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCamera, useCanvas, useFrame, useLoader, useResource, useThree, useUpdate };\n"]},"metadata":{},"sourceType":"module"}